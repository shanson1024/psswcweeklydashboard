<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weekly Sales Dashboard - Precise & WorkComp 360</title>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.10.3/Recharts.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Ensure Recharts is available globally before Babel compiles
    window.addEventListener('DOMContentLoaded', function() {
      if (!window.Recharts) {
        document.getElementById('root').innerHTML = '<p style="padding:20px;color:red;">Error: Recharts failed to load. Please refresh.</p>';
      }
    });
  </script>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState } = React;
    const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

    function SalesDashboard() {
      const [viewType, setViewType] = useState('both');
      
      // Actual data from billing reports
      const weeklyData = [
        { week: 'WE 1/4', weekFull: 'Week Ending 1/4/2026', precise: 718398.39, workcomp: 75632.57 },
        { week: 'WE 1/11', weekFull: 'Week Ending 1/11/2026', precise: 990107.32, workcomp: 109706.82 },
        { week: 'WE 1/18', weekFull: 'Week Ending 1/18/2026', precise: 993466.60, workcomp: 114999.86 },
        { week: 'WE 1/25', weekFull: 'Week Ending 1/25/2026', precise: 945671.42, workcomp: 119048.54 },
        { week: 'WE 2/1', weekFull: 'Week Ending 2/1/2026', precise: 982055.71, workcomp: 118943.00 },
        { week: 'WE 2/8', weekFull: 'Week Ending 2/8/2026', precise: 986493.32, workcomp: 119903.14 },
        { week: 'WE 2/15', weekFull: 'Week Ending 2/15/2026', precise: 994348.08, workcomp: 118520.27 },
      ];

      // Calculate totals
      const workcompTotal = weeklyData.reduce((sum, w) => sum + w.workcomp, 0);
      const preciseTotal = weeklyData.reduce((sum, w) => sum + w.precise, 0);
      const grandTotal = preciseTotal + workcompTotal;
      
      const currentWeek = weeklyData[weeklyData.length - 1];
      const previousWeek = weeklyData[weeklyData.length - 2];
      
      const preciseGrowth = ((currentWeek.precise - previousWeek.precise) / previousWeek.precise * 100).toFixed(1);
      const workcompGrowth = ((currentWeek.workcomp - previousWeek.workcomp) / previousWeek.workcomp * 100).toFixed(1);

      const formatCurrency = (value) => `$${value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
      const formatCompact = (value) => `$${(value/1000).toFixed(0)}k`;

      const MetricCard = ({ title, value, subtitle, trend, color }) => (
        <div className="bg-white rounded-lg p-5 shadow-sm border border-gray-100">
          <p className="text-sm text-gray-500 font-medium">{title}</p>
          <p className={`text-2xl font-bold mt-1 ${color}`}>{value}</p>
          <div className="flex items-center mt-2">
            {trend !== undefined && (
              <span className={`text-sm font-medium ${parseFloat(trend) >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                {parseFloat(trend) >= 0 ? '↑' : '↓'} {Math.abs(trend)}%
              </span>
            )}
            {subtitle && <span className="text-sm text-gray-400 ml-2">{subtitle}</span>}
          </div>
        </div>
      );

      const filteredData = weeklyData.map(w => ({
        ...w,
        precise: viewType === 'workcomp' ? 0 : w.precise,
        workcomp: viewType === 'precise' ? 0 : w.workcomp,
      }));

      return (
        <div className="min-h-screen bg-gray-50 p-6">
          <div className="max-w-6xl mx-auto">
            {/* Header */}
            <div className="flex justify-between items-start mb-8">
              <div>
                <h1 className="text-2xl font-bold text-gray-900">Weekly Sales Dashboard</h1>
                <p className="text-gray-500 mt-1">Precise & WorkComp 360</p>
              </div>
              <div className="text-right text-sm text-gray-400">
                <p>Data through: Week Ending 2/15/2026</p>
              </div>
            </div>

            {/* Summary Cards */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
              <MetricCard 
                title="Precise (Latest)" 
                value={formatCurrency(currentWeek.precise)}
                trend={preciseGrowth}
                subtitle="vs prior week"
                color="text-blue-600"
              />
              <MetricCard 
                title="Precise (7 Weeks)" 
                value={formatCurrency(preciseTotal)}
                subtitle={`avg ${formatCompact(preciseTotal/5)}/wk`}
                color="text-blue-600"
              />
              <MetricCard 
                title="WorkComp 360 (Latest)" 
                value={formatCurrency(currentWeek.workcomp)} 
                trend={workcompGrowth}
                subtitle="vs prior week"
                color="text-emerald-600"
              />
              <MetricCard 
                title="WorkComp 360 (7 Weeks)" 
                value={formatCurrency(workcompTotal)} 
                subtitle={`avg ${formatCompact(workcompTotal/5)}/wk`}
                color="text-emerald-600"
              />
            </div>

            {/* Combined Total Banner */}
            <div className="bg-gradient-to-r from-blue-600 to-emerald-600 rounded-lg p-6 mb-8 text-white">
              <div className="grid grid-cols-3 gap-4">
                <div>
                  <p className="text-blue-100 text-sm font-medium">Precise Total</p>
                  <p className="text-2xl font-bold mt-1">{formatCurrency(preciseTotal)}</p>
                </div>
                <div className="text-center">
                  <p className="text-white/80 text-sm font-medium">Combined Total (7 Weeks)</p>
                  <p className="text-3xl font-bold mt-1">{formatCurrency(grandTotal)}</p>
                </div>
                <div className="text-right">
                  <p className="text-emerald-100 text-sm font-medium">WorkComp 360 Total</p>
                  <p className="text-2xl font-bold mt-1">{formatCurrency(workcompTotal)}</p>
                </div>
              </div>
            </div>

            {/* View Toggle */}
            <div className="flex gap-2 mb-6">
              {[
                { key: 'both', label: 'Both Products' },
                { key: 'precise', label: 'Precise Only' },
                { key: 'workcomp', label: 'WorkComp 360 Only' },
              ].map(({ key, label }) => (
                <button
                  key={key}
                  onClick={() => setViewType(key)}
                  className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                    viewType === key 
                      ? 'bg-gray-900 text-white' 
                      : 'bg-white text-gray-600 hover:bg-gray-100 border border-gray-200'
                  }`}
                >
                  {label}
                </button>
              ))}
            </div>

            {/* Revenue Chart */}
            <div className="bg-white rounded-lg p-6 shadow-sm border border-gray-100 mb-6">
              <h2 className="text-lg font-semibold text-gray-900 mb-4">Weekly Revenue Comparison</h2>
              <ResponsiveContainer width="100%" height={320}>
                <BarChart data={filteredData} margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                  <XAxis dataKey="week" tick={{ fontSize: 12 }} stroke="#9ca3af" />
                  <YAxis tickFormatter={(v) => `$${(v/1000).toFixed(0)}k`} tick={{ fontSize: 12 }} stroke="#9ca3af" />
                  <Tooltip 
                    formatter={(value) => formatCurrency(value)}
                    labelFormatter={(label) => weeklyData.find(w => w.week === label)?.weekFull}
                  />
                  <Legend />
                  {viewType !== 'workcomp' && (
                    <Bar dataKey="precise" name="Precise" fill="#2563eb" radius={[4, 4, 0, 0]} />
                  )}
                  {viewType !== 'precise' && (
                    <Bar dataKey="workcomp" name="WorkComp 360" fill="#10b981" radius={[4, 4, 0, 0]} />
                  )}
                </BarChart>
              </ResponsiveContainer>
            </div>

            {/* Data Table */}
            <div className="bg-white rounded-lg p-6 shadow-sm border border-gray-100">
              <h2 className="text-lg font-semibold text-gray-900 mb-4">Weekly Breakdown</h2>
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead>
                    <tr className="border-b border-gray-200">
                      <th className="text-left py-3 px-2 font-medium text-gray-500">Week Ending</th>
                      <th className="text-right py-3 px-2 font-medium text-blue-600">Precise</th>
                      <th className="text-right py-3 px-2 font-medium text-emerald-600">WorkComp 360</th>
                      <th className="text-right py-3 px-2 font-medium text-gray-900">Total</th>
                    </tr>
                  </thead>
                  <tbody>
                    {weeklyData.map((row, i) => (
                      <tr key={i} className="border-b border-gray-100 hover:bg-gray-50">
                        <td className="py-3 px-2 font-medium">{row.weekFull}</td>
                        <td className="py-3 px-2 text-right">{formatCurrency(row.precise)}</td>
                        <td className="py-3 px-2 text-right">{formatCurrency(row.workcomp)}</td>
                        <td className="py-3 px-2 text-right font-medium">{formatCurrency(row.precise + row.workcomp)}</td>
                      </tr>
                    ))}
                    <tr className="bg-gray-50 font-semibold">
                      <td className="py-3 px-2">Total (7 Weeks)</td>
                      <td className="py-3 px-2 text-right text-blue-600">{formatCurrency(preciseTotal)}</td>
                      <td className="py-3 px-2 text-right text-emerald-600">{formatCurrency(workcompTotal)}</td>
                      <td className="py-3 px-2 text-right">{formatCurrency(grandTotal)}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            {/* Product Mix */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
              {/* Precise Breakdown */}
              <div className="bg-white rounded-lg p-6 shadow-sm border border-gray-100">
                <h2 className="text-lg font-semibold text-gray-900 mb-4">Precise — Revenue Mix</h2>
                <div className="space-y-3">
                  <div className="flex justify-between items-center">
                    <span className="text-gray-600">Share of Total</span>
                    <span className="font-bold text-blue-600">{((preciseTotal / grandTotal) * 100).toFixed(1)}%</span>
                  </div>
                  <div className="w-full bg-gray-200 rounded-full h-3">
                    <div className="bg-blue-600 h-3 rounded-full" style={{ width: `${(preciseTotal / grandTotal) * 100}%` }}></div>
                  </div>
                  <div className="pt-3 border-t border-gray-100 mt-4 space-y-2">
                    <div className="flex justify-between text-sm">
                      <span className="text-gray-500">7-Week Total</span>
                      <span className="font-medium">{formatCurrency(preciseTotal)}</span>
                    </div>
                    <div className="flex justify-between text-sm">
                      <span className="text-gray-500">Avg Weekly</span>
                      <span className="font-medium">{formatCurrency(preciseTotal / 7)}</span>
                    </div>
                    <div className="flex justify-between text-sm">
                      <span className="text-gray-500">WoW Change</span>
                      <span className={`font-medium ${parseFloat(preciseGrowth) >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                        {parseFloat(preciseGrowth) >= 0 ? '↑' : '↓'} {Math.abs(parseFloat(preciseGrowth))}%
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              {/* WorkComp Breakdown */}
              <div className="bg-white rounded-lg p-6 shadow-sm border border-gray-100">
                <h2 className="text-lg font-semibold text-gray-900 mb-4">WorkComp 360 — Revenue Mix</h2>
                <div className="space-y-3">
                  <div className="flex justify-between items-center">
                    <span className="text-gray-600">Share of Total</span>
                    <span className="font-bold text-emerald-600">{((workcompTotal / grandTotal) * 100).toFixed(1)}%</span>
                  </div>
                  <div className="w-full bg-gray-200 rounded-full h-3">
                    <div className="bg-emerald-600 h-3 rounded-full" style={{ width: `${(workcompTotal / grandTotal) * 100}%` }}></div>
                  </div>
                  <div className="pt-3 border-t border-gray-100 mt-4 space-y-2">
                    <div className="flex justify-between text-sm">
                      <span className="text-gray-500">7-Week Total</span>
                      <span className="font-medium">{formatCurrency(workcompTotal)}</span>
                    </div>
                    <div className="flex justify-between text-sm">
                      <span className="text-gray-500">Avg Weekly</span>
                      <span className="font-medium">{formatCurrency(workcompTotal / 7)}</span>
                    </div>
                    <div className="flex justify-between text-sm">
                      <span className="text-gray-500">WoW Change</span>
                      <span className={`font-medium ${parseFloat(workcompGrowth) >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                        {parseFloat(workcompGrowth) >= 0 ? '↑' : '↓'} {Math.abs(parseFloat(workcompGrowth))}%
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {/* Weekly Goal Tracker */}
            <div className="bg-white rounded-lg p-6 shadow-sm border border-gray-100 mt-6">
              <h2 className="text-lg font-semibold text-gray-900 mb-4">Weekly Goal Tracker</h2>
              <div className="mb-4">
                <div className="flex justify-between items-center mb-2">
                  <span className="text-gray-600">Weekly Goal (Combined)</span>
                  <span className="font-bold text-gray-900">{formatCurrency(1400000)}</span>
                </div>
              </div>
              <div className="space-y-4">
                {weeklyData.map((week, i) => {
                  const weekTotal = week.precise + week.workcomp;
                  const variance = weekTotal - 1400000;
                  const percentOfGoal = (weekTotal / 1400000) * 100;
                  const isPositive = variance >= 0;
                  return (
                    <div key={i} className="border-b border-gray-100 pb-4 last:border-0 last:pb-0">
                      <div className="flex justify-between items-center mb-2">
                        <span className="font-medium text-gray-900">{week.weekFull}</span>
                        <span className={`font-bold ${isPositive ? 'text-green-600' : 'text-red-600'}`}>
                          {isPositive ? '+' : ''}{formatCurrency(variance)}
                        </span>
                      </div>
                      <div className="flex items-center gap-3">
                        <div className="flex-1 bg-gray-200 rounded-full h-2">
                          <div 
                            className={`h-2 rounded-full ${isPositive ? 'bg-green-500' : 'bg-amber-500'}`}
                            style={{ width: `${Math.min(percentOfGoal, 100)}%` }}
                          ></div>
                        </div>
                        <span className="text-sm text-gray-500 w-20 text-right">{percentOfGoal.toFixed(1)}%</span>
                      </div>
                      <div className="flex justify-between text-sm text-gray-500 mt-1">
                        <span>Actual: {formatCurrency(weekTotal)}</span>
                        <span>{isPositive ? 'Over goal' : `${formatCurrency(Math.abs(variance))} to go`}</span>
                      </div>
                    </div>
                  );
                })}
              </div>
              <div className="mt-4 pt-4 border-t border-gray-200">
                <div className="flex justify-between items-center">
                  <span className="font-medium text-gray-900">7-Week Average</span>
                  {(() => {
                    const avgWeekly = grandTotal / 7;
                    const avgVariance = avgWeekly - 1400000;
                    const isPositive = avgVariance >= 0;
                    return (
                      <div className="text-right">
                        <span className="font-bold text-gray-900">{formatCurrency(avgWeekly)}</span>
                        <span className={`ml-2 text-sm font-medium ${isPositive ? 'text-green-600' : 'text-red-600'}`}>
                          ({isPositive ? '+' : ''}{formatCurrency(avgVariance)})
                        </span>
                      </div>
                    );
                  })()}
                </div>
              </div>
            </div>

            {/* Annual Goal Projection */}
            <div className="bg-white rounded-lg p-6 shadow-sm border border-gray-100 mt-6">
              <h2 className="text-lg font-semibold text-gray-900 mb-2">Annual Goal Projection</h2>
              <p className="text-sm text-gray-500 mb-4">15% annual increase starting February 2026</p>
              
              {/* Current Year Progress */}
              <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <div className="flex justify-between items-center mb-3">
                  <span className="font-semibold text-blue-900">Current Year Progress (Feb 2026 – Jan 2027)</span>
                  <span className="text-sm text-blue-600">{weeklyData.length} weeks completed</span>
                </div>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                  <div>
                    <p className="text-xs text-blue-600 uppercase tracking-wide">YTD Actual</p>
                    <p className="text-lg font-bold text-blue-900">{formatCurrency(grandTotal)}</p>
                  </div>
                  <div>
                    <p className="text-xs text-blue-600 uppercase tracking-wide">YTD Goal ({weeklyData.length} wks)</p>
                    <p className="text-lg font-bold text-blue-900">{formatCurrency(1400000 * weeklyData.length)}</p>
                  </div>
                  <div>
                    <p className="text-xs text-blue-600 uppercase tracking-wide">Variance</p>
                    <p className={`text-lg font-bold ${grandTotal >= 1400000 * weeklyData.length ? 'text-green-600' : 'text-red-600'}`}>
                      {grandTotal >= 1400000 * weeklyData.length ? '+' : ''}{formatCurrency(grandTotal - 1400000 * weeklyData.length)}
                    </p>
                  </div>
                  <div>
                    <p className="text-xs text-blue-600 uppercase tracking-wide">% of YTD Goal</p>
                    <p className={`text-lg font-bold ${(grandTotal / (1400000 * weeklyData.length)) >= 1 ? 'text-green-600' : 'text-amber-600'}`}>
                      {((grandTotal / (1400000 * weeklyData.length)) * 100).toFixed(1)}%
                    </p>
                  </div>
                </div>
                <div className="mt-3">
                  <div className="flex justify-between text-xs text-blue-600 mb-1">
                    <span>Progress to Annual Goal</span>
                    <span>{((grandTotal / (1400000 * 52)) * 100).toFixed(2)}% of {formatCurrency(1400000 * 52)}</span>
                  </div>
                  <div className="w-full bg-blue-200 rounded-full h-2">
                    <div 
                      className="bg-blue-600 h-2 rounded-full" 
                      style={{ width: `${(grandTotal / (1400000 * 52)) * 100}%` }}
                    ></div>
                  </div>
                </div>
              </div>

              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead>
                    <tr className="border-b border-gray-200">
                      <th className="text-left py-3 px-2 font-medium text-gray-500">Period</th>
                      <th className="text-right py-3 px-2 font-medium text-gray-500">Weekly Goal</th>
                      <th className="text-right py-3 px-2 font-medium text-gray-500">Monthly Goal</th>
                      <th className="text-right py-3 px-2 font-medium text-gray-500">Annual Goal</th>
                      <th className="text-right py-3 px-2 font-medium text-gray-500">YTD Actual</th>
                    </tr>
                  </thead>
                  <tbody>
                    {[
                      { period: 'Feb 2026 – Jan 2027', year: 0 },
                      { period: 'Feb 2027 – Jan 2028', year: 1 },
                      { period: 'Feb 2028 – Jan 2029', year: 2 },
                      { period: 'Feb 2029 – Jan 2030', year: 3 },
                      { period: 'Feb 2030 – Jan 2031', year: 4 },
                    ].map((row, i) => {
                      const weeklyGoal = 1400000 * Math.pow(1.15, row.year);
                      const monthlyGoal = weeklyGoal * 4.33;
                      const annualGoal = weeklyGoal * 52;
                      const isCurrent = row.year === 0;
                      const ytdActual = isCurrent ? grandTotal : null;
                      const ytdGoal = isCurrent ? 1400000 * weeklyData.length : null;
                      return (
                        <tr key={i} className={`border-b border-gray-100 ${isCurrent ? 'bg-blue-50' : 'hover:bg-gray-50'}`}>
                          <td className="py-3 px-2 font-medium">
                            {row.period}
                            {isCurrent && <span className="ml-2 text-xs text-blue-600 font-semibold">CURRENT</span>}
                          </td>
                          <td className="py-3 px-2 text-right">{formatCurrency(weeklyGoal)}</td>
                          <td className="py-3 px-2 text-right">{formatCurrency(monthlyGoal)}</td>
                          <td className="py-3 px-2 text-right font-medium">{formatCurrency(annualGoal)}</td>
                          <td className="py-3 px-2 text-right">
                            {isCurrent ? (
                              <div>
                                <span className="font-medium">{formatCurrency(ytdActual)}</span>
                                <span className={`ml-1 text-xs ${ytdActual >= ytdGoal ? 'text-green-600' : 'text-red-600'}`}>
                                  ({((ytdActual / ytdGoal) * 100).toFixed(1)}%)
                                </span>
                              </div>
                            ) : (
                              <span className="text-gray-400">—</span>
                            )}
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
              </div>
              <div className="mt-4 pt-4 border-t border-gray-100">
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                  <div>
                    <p className="text-xs text-gray-500 uppercase tracking-wide">Year 1 Annual</p>
                    <p className="text-lg font-bold text-gray-900">{formatCurrency(1400000 * 52)}</p>
                  </div>
                  <div>
                    <p className="text-xs text-gray-500 uppercase tracking-wide">Year 3 Annual</p>
                    <p className="text-lg font-bold text-gray-900">{formatCurrency(1400000 * Math.pow(1.15, 2) * 52)}</p>
                  </div>
                  <div>
                    <p className="text-xs text-gray-500 uppercase tracking-wide">Year 5 Annual</p>
                    <p className="text-lg font-bold text-gray-900">{formatCurrency(1400000 * Math.pow(1.15, 4) * 52)}</p>
                  </div>
                  <div>
                    <p className="text-xs text-gray-500 uppercase tracking-wide">5-Year Growth</p>
                    <p className="text-lg font-bold text-emerald-600">+74.9%</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    try {
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<SalesDashboard />);
    } catch(e) {
      document.getElementById('root').innerHTML = '<p style="padding:20px;color:red;">Error: ' + e.message + '</p>';
    }
  </script>
</body>
</html>
